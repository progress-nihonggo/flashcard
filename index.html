<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flashcard Kanji - 441 Kata</title>
  <style>
    :root {
      --w: 480px;
      --h: 380px;
      --bg-primary: linear-gradient(135deg, #fef5f8, #ffe4f0);
      --card-front: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(252,240,245,0.98));
      --card-back: linear-gradient(180deg, #ec4899, #db2777);
      --text-primary: #0f172a;
      --text-secondary: rgba(15,23,42,0.7);
      --shadow: 0 24px 60px rgba(236,72,153,0.12);
      --btn-bg: #fff;
      --btn-shadow: 0 6px 18px rgba(236,72,153,0.08);
    }
    
    [data-theme="dark"] {
      --bg-primary: linear-gradient(135deg, #1e1b4b, #312e81);
      --card-front: linear-gradient(180deg, rgba(30,27,75,0.95), rgba(49,46,129,0.98));
      --card-back: linear-gradient(180deg, #6366f1, #4f46e5);
      --text-primary: #e0e7ff;
      --text-secondary: rgba(224,231,255,0.7);
      --shadow: 0 24px 60px rgba(99,102,241,0.3);
      --btn-bg: rgba(99,102,241,0.2);
      --btn-shadow: 0 6px 18px rgba(99,102,241,0.3);
    }
    
    [data-theme="light"] {
      --bg-primary: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      --card-front: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(240,249,255,0.98));
      --card-back: linear-gradient(180deg, #0ea5e9, #0284c7);
      --text-primary: #0f172a;
      --text-secondary: rgba(15,23,42,0.7);
      --shadow: 0 24px 60px rgba(14,165,233,0.12);
      --btn-bg: #fff;
      --btn-shadow: 0 6px 18px rgba(14,165,233,0.08);
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Inter, system-ui, -apple-system, Roboto, Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background: var(--bg-primary);
      transition: background 0.3s;
    }

    header {
      width: 100%;
      max-width: 1000px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    h1 {
      margin: 0 0 8px 0;
      font-size: 26px;
      color: var(--text-primary);
      font-weight: 700;
    }
    
    .subtitle {
      margin: 0;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: var(--text-primary);
    }

    .error {
      background: #fee;
      color: #c00;
      padding: 20px;
      border-radius: 12px;
      margin: 20px;
      text-align: center;
    }

    .controls-panel {
      width: 100%;
      max-width: 1000px;
      margin-bottom: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    .control-group {
      display: flex;
      gap: 8px;
      align-items: center;
      background: var(--btn-bg);
      padding: 8px 14px;
      border-radius: 12px;
      box-shadow: var(--btn-shadow);
    }

    .control-group label {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 500;
      margin-right: 4px;
    }

    select, button {
      padding: 8px 14px;
      border-radius: 10px;
      border: none;
      background: var(--btn-bg);
      color: var(--text-primary);
      box-shadow: var(--btn-shadow);
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover, select:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    button:active {
      transform: translateY(0);
    }

    .mode-switch {
      display: flex;
      gap: 4px;
      background: var(--btn-bg);
      padding: 4px;
      border-radius: 12px;
      box-shadow: var(--btn-shadow);
    }

    .mode-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background: transparent;
      box-shadow: none;
      transition: all 0.3s;
    }

    .mode-btn.active {
      background: linear-gradient(135deg, #ec4899, #db2777);
      color: white;
      box-shadow: 0 4px 12px rgba(236,72,153,0.3);
    }

    [data-theme="dark"] .mode-btn.active {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
    }

    [data-theme="light"] .mode-btn.active {
      background: linear-gradient(135deg, #0ea5e9, #0284c7);
    }

    .stage {
      width: 100%;
      max-width: var(--w);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }

    .scene {
      width: var(--w);
      height: var(--h);
      perspective: 1400px;
    }

    .card {
      width: 100%;
      height: 100%;
      border-radius: 20px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
      cursor: pointer;
    }

    .card.is-flipped {
      transform: rotateY(180deg);
    }

    .face {
      position: absolute;
      inset: 0;
      border-radius: 20px;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      backface-visibility: hidden;
      background: var(--card-front);
      box-shadow: var(--shadow);
      color: var(--text-primary);
    }

    .face.back {
      transform: rotateY(180deg);
      background: var(--card-back);
      color: white;
    }

    .kanji {
      font-weight: 800;
      line-height: 1;
      margin-bottom: 8px;
      text-align: center;
    }

    .furigana {
      color: rgba(255,255,255,0.9);
      margin-bottom: 8px;
      text-align: center;
    }

    .meaning {
      color: rgba(255,255,255,0.95);
      margin-top: 8px;
      text-align: center;
      font-weight: 500;
    }

    .level-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255,255,255,0.3);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    [data-font="default"] .kanji { font-size: clamp(48px, 8vw, 72px); }
    [data-font="default"] .furigana { font-size: clamp(16px, 2.5vw, 22px); }
    [data-font="default"] .meaning { font-size: clamp(18px, 3vw, 24px); }

    [data-font="medium"] .kanji { font-size: clamp(60px, 10vw, 90px); }
    [data-font="medium"] .furigana { font-size: clamp(20px, 3vw, 28px); }
    [data-font="medium"] .meaning { font-size: clamp(22px, 3.5vw, 30px); }

    [data-font="big"] .kanji { font-size: clamp(72px, 12vw, 108px); }
    [data-font="big"] .furigana { font-size: clamp(24px, 3.5vw, 34px); }
    [data-font="big"] .meaning { font-size: clamp(26px, 4vw, 36px); }

    .controls-row {
      display: flex;
      gap: 10px;
      width: 100%;
      justify-content: center;
      flex-wrap: wrap;
    }

    .pager {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .meta {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 600;
      min-width: 80px;
      text-align: center;
    }

    .quiz-panel {
      display: none;
      width: 100%;
      max-width: 600px;
      background: var(--btn-bg);
      padding: 20px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      margin-top: 20px;
    }

    .quiz-panel.active {
      display: block;
    }

    .quiz-options {
      display: grid;
      gap: 10px;
      margin-top: 15px;
    }

    .quiz-option {
      padding: 14px 18px;
      border-radius: 10px;
      background: var(--btn-bg);
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
      font-size: 15px;
      color: var(--text-primary);
    }

    .quiz-option:hover {
      border-color: #ec4899;
      transform: translateX(4px);
    }

    .quiz-option.correct {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }

    .quiz-option.wrong {
      background: #ef4444;
      color: white;
      border-color: #ef4444;
    }

    .quiz-option:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .quiz-settings {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .quiz-settings label {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .quiz-settings input {
      padding: 6px 10px;
      border-radius: 8px;
      border: 2px solid var(--text-secondary);
      background: transparent;
      color: var(--text-primary);
      font-size: 14px;
      width: 80px;
    }

    .quiz-result {
      margin-top: 15px;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      display: none;
    }

    .quiz-result.show {
      display: block;
    }

    @media (max-width: 560px) {
      :root { --w: 92vw; --h: 70vw; }
      h1 { font-size: 22px; }
      .controls-panel { padding: 0 8px; }
    }
  </style>
</head>
<body data-theme="sakura" data-font="default">
  <div id="loadingScreen" class="loading">
    ‚è≥ Memuat data kanji...
  </div>

  <div id="mainContent" style="display:none; width:100%; display:flex; flex-direction:column; align-items:center;">
    <header>
      <h1>üìö Flashcard Kanji - 441 Kata</h1>
      <p class="subtitle">Belajar Kanji dengan mudah dan menyenangkan!</p>
    </header>

    <div class="controls-panel">
      <div class="control-group">
        <label>Tema:</label>
        <select id="themeSelect">
          <option value="sakura">üå∏ Sakura</option>
          <option value="dark">üåô Dark</option>
          <option value="light">‚òÄÔ∏è Light</option>
        </select>
      </div>

      <div class="control-group">
        <label>Ukuran Font:</label>
        <select id="fontSelect">
          <option value="default">Default</option>
          <option value="medium">Medium</option>
          <option value="big">Big</option>
        </select>
      </div>

      <div class="control-group">
        <label>Filter Level:</label>
        <select id="levelFilter">
          <option value="all">Semua Level</option>
          <option value="1">Level 1</option>
          <option value="2">Level 2</option>
          <option value="3">Level 3</option>
          <option value="4">Level 4</option>
          <option value="5">Level 5</option>
          <option value="6">Level 6</option>
          <option value="7">Level 7</option>
          <option value="8">Level 8</option>
          <option value="9">Level 9</option>
        </select>
      </div>

      <div class="mode-switch">
        <button class="mode-btn active" data-mode="normal">üìñ Normal</button>
        <button class="mode-btn" data-mode="quiz">‚úçÔ∏è Ujian</button>
      </div>
    </div>

    <div class="stage" id="normalMode">
      <div class="scene">
        <div class="card" id="card">
          <div class="face front">
            <div class="level-badge" id="levelBadgeFront">Lv 1</div>
            <div class="kanji" id="frontKanji">‚Äî</div>
          </div>
          <div class="face back">
            <div class="level-badge" id="levelBadgeBack">Lv 1</div>
            <div class="kanji" id="backKanji">‚Äî</div>
            <div class="furigana" id="backFuri">‚Äî</div>
            <div class="meaning" id="backMeaning">‚Äî</div>
          </div>
        </div>
      </div>

      <div class="controls-row">
        <div class="pager">
          <button id="prevBtn">‚Üê Prev</button>
          <div class="meta" id="progress">0 / 0</div>
          <button id="nextBtn">Next ‚Üí</button>
        </div>
        <button id="flipBtn">üîÑ Balik</button>
        <button id="shuffleBtn">üé≤ Acak</button>
      </div>
    </div>

    <div class="quiz-panel" id="quizMode">
      <div class="quiz-settings">
        <label>Interval (detik):</label>
        <input type="number" id="quizInterval" value="10" min="5" max="60">
        <button id="startQuizBtn">‚ñ∂Ô∏è Mulai Ujian</button>
        <button id="stopQuizBtn" style="display:none;">‚è∏Ô∏è Stop</button>
      </div>
      
      <div style="margin-top:20px;">
        <h2 style="margin:0 0 10px 0; font-size:20px; color: var(--text-primary);">Arti dari:</h2>
        <div style="font-size:48px; font-weight:800; text-align:center; margin:20px 0; color: var(--text-primary);" id="quizKanji">‚Äî</div>
        <div class="quiz-options" id="quizOptions"></div>
        <div class="quiz-result" id="quizResult"></div>
      </div>

      <div style="margin-top:20px; text-align:center; color: var(--text-primary);">
        <strong>Skor: <span id="quizScore">0</span> / <span id="quizTotal">0</span></strong>
        <span style="margin-left:20px;">Waktu: <span id="quizTimer">0</span>s</span>
      </div>
    </div>
  </div>

  <script>
    // Variables
    let allKanjiData = [];
    let filteredCards = [];
    let currentIndex = 0;
    let quizTimer = null;
    let quizTimeElapsed = 0;
    let quizScore = 0;
    let quizTotal = 0;
    let currentQuizQuestion = null;

    // Elements
    const loadingScreen = document.getElementById('loadingScreen');
    const mainContent = document.getElementById('mainContent');
    const themeSelect = document.getElementById('themeSelect');
    const fontSelect = document.getElementById('fontSelect');
    const levelFilter = document.getElementById('levelFilter');
    const card = document.getElementById('card');
    const frontKanji = document.getElementById('frontKanji');
    const backKanji = document.getElementById('backKanji');
    const backFuri = document.getElementById('backFuri');
    const backMeaning = document.getElementById('backMeaning');
    const levelBadgeFront = document.getElementById('levelBadgeFront');
    const levelBadgeBack = document.getElementById('levelBadgeBack');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const flipBtn = document.getElementById('flipBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const progress = document.getElementById('progress');
    const normalMode = document.getElementById('normalMode');
    const quizMode = document.getElementById('quizMode');
    const startQuizBtn = document.getElementById('startQuizBtn');
    const stopQuizBtn = document.getElementById('stopQuizBtn');
    const quizInterval = document.getElementById('quizInterval');
    const quizKanji = document.getElementById('quizKanji');
    const quizOptions = document.getElementById('quizOptions');
    const quizResult = document.getElementById('quizResult');
    const quizScoreEl = document.getElementById('quizScore');
    const quizTotalEl = document.getElementById('quizTotal');
    const quizTimerEl = document.getElementById('quizTimer');

    // Load Kanji Data from JSON
    async function loadKanjiData() {
      try {
        const response = await fetch('kanji.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        allKanjiData = await response.json();
        
        if (!allKanjiData || allKanjiData.length === 0) {
          throw new Error('Data kanji kosong atau format salah');
        }

        filteredCards = [...allKanjiData];
        loadingScreen.style.display = 'none';
        mainContent.style.display = 'flex';
        render();
        console.log(`‚úÖ Berhasil memuat ${allKanjiData.length} kanji`);
      } catch (error) {
        console.error('Error loading kanji data:', error);
        loadingScreen.innerHTML = `
          <div class="error">
            <h3>‚ùå Gagal Memuat Data Kanji</h3>
            <p>Error: ${error.message}</p>
            <p style="margin-top:15px; font-size:14px;">
              <strong>Pastikan:</strong><br>
              1. File <code>kanji.json</code> ada di folder yang sama dengan index.html<br>
              2. Jalankan dengan local web server (bukan buka file langsung)<br>
              3. Gunakan: <code>python -m http.server 8000</code> atau <code>php -S localhost:8000</code>
            </p>
          </div>
        `;
      }
    }

    // Render flashcard
    function render() {
      if (!filteredCards.length) {
        frontKanji.textContent = '‚Äî';
        backKanji.textContent = '‚Äî';
        backFuri.textContent = '‚Äî';
        backMeaning.textContent = '‚Äî';
        levelBadgeFront.textContent = '‚Äî';
        levelBadgeBack.textContent = '‚Äî';
        progress.textContent = '0 / 0';
        return;
      }

      const c = filteredCards[currentIndex];
      frontKanji.textContent = c.kanji;
      backKanji.textContent = c.kanji;
      backFuri.textContent = c.furi;
      backMeaning.textContent = c.meaning;
      levelBadgeFront.textContent = `Lv ${c.level}`;
      levelBadgeBack.textContent = `Lv ${c.level}`;
      progress.textContent = `${currentIndex + 1} / ${filteredCards.length}`;
      card.classList.remove('is-flipped');
    }

    // Navigation
    function next() {
      if (!filteredCards.length) return;
      currentIndex = (currentIndex + 1) % filteredCards.length;
      render();
    }

    function prev() {
      if (!filteredCards.length) return;
      currentIndex = (currentIndex - 1 + filteredCards.length) % filteredCards.length;
      render();
    }

    function flip() {
      if (!filteredCards.length) return;
      card.classList.toggle('is-flipped');
    }

    function shuffle() {
      if (!filteredCards.length) return;
      filteredCards.sort(() => Math.random() - 0.5);
      currentIndex = 0;
      render();
    }

    // Theme & Font
    themeSelect.addEventListener('change', (e) => {
      document.body.setAttribute('data-theme', e.target.value);
    });

    fontSelect.addEventListener('change', (e) => {
      document.body.setAttribute('data-font', e.target.value);
    });

    // Level Filter
    levelFilter.addEventListener('change', (e) => {
      const level = e.target.value;
      if (level === 'all') {
        filteredCards = [...allKanjiData];
      } else {
        filteredCards = allKanjiData.filter(k => k.level === parseInt(level));
      }
      currentIndex = 0;
      render();
    });

    // Mode Switch
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const mode = btn.dataset.mode;
        if (mode === 'normal') {
          normalMode.style.display = 'flex';
          quizMode.classList.remove('active');
          stopQuiz();
        } else {
          normalMode.style.display = 'none';
          quizMode.classList.add('active');
        }
      });
    });

    // Quiz Mode
    function startQuiz() {
      if (!filteredCards.length) return;
      
      quizScore = 0;
      quizTotal = 0;
      quizTimeElapsed = 0;
      quizScoreEl.textContent = '0';
      quizTotalEl.textContent = '0';
      quizTimerEl.textContent = '0';
      
      startQuizBtn.style.display = 'none';
      stopQuizBtn.style.display = 'inline-block';
      
      generateQuizQuestion();
      
      quizTimer = setInterval(() => {
        quizTimeElapsed++;
        quizTimerEl.textContent = quizTimeElapsed;
      }, 1000);
    }

    function stopQuiz() {
      if (quizTimer) {
        clearInterval(quizTimer);
        quizTimer = null;
      }
      startQuizBtn.style.display = 'inline-block';
      stopQuizBtn.style.display = 'none';
      quizResult.classList.remove('show');
    }

    function generateQuizQuestion() {
      if (!filteredCards.length) return;
      
      quizResult.classList.remove('show');
      
      // Random kanji
      const randomIndex = Math.floor(Math.random() * filteredCards.length);
      currentQuizQuestion = filteredCards[randomIndex];
      
      quizKanji.textContent = currentQuizQuestion.kanji;
      
      // Generate options
      const correctAnswer = currentQuizQuestion.meaning;
      const wrongAnswers = [];
      
      while (wrongAnswers.length < 3) {
        const randomKanji = filteredCards[Math.floor(Math.random() * filteredCards.length)];
        if (randomKanji.meaning !== correctAnswer && !wrongAnswers.includes(randomKanji.meaning)) {
          wrongAnswers.push(randomKanji.meaning);
        }
      }
      
      const allOptions = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);
      
      quizOptions.innerHTML = '';
      allOptions.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'quiz-option';
        btn.textContent = option;
        btn.onclick = () => checkAnswer(option, correctAnswer);
        quizOptions.appendChild(btn);
      });
    }

    function checkAnswer(selected, correct) {
      quizTotal++;
      quizTotalEl.textContent = quizTotal;
      
      const buttons = quizOptions.querySelectorAll('.quiz-option');
      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === correct) {
          btn.classList.add('correct');
        }
        if (btn.textContent === selected && selected !== correct) {
          btn.classList.add('wrong');
        }
      });
      
      if (selected === correct) {
        quizScore++;
        quizScoreEl.textContent = quizScore;
        quizResult.textContent = '‚úÖ Benar!';
        quizResult.style.background = '#d1fae5';
        quizResult.style.color = '#065f46';
      } else {
        quizResult.textContent = `‚ùå Salah! Jawaban: ${correct}`;
        quizResult.style.background = '#fee2e2';
        quizResult.style.color = '#991b1b';
      }
      
      quizResult.classList.add('show');
      
      const interval = parseInt(quizInterval.value) * 1000;
      setTimeout(() => {
        if (quizTimer) {
          generateQuizQuestion();
        }
      }, interval);
    }

    // Event Listeners
    nextBtn.onclick = next;
    prevBtn.onclick = prev;
    flipBtn.onclick = flip;
    shuffleBtn.onclick = shuffle;
    card.onclick = flip;
    startQuizBtn.onclick = startQuiz;
    stopQuizBtn.onclick = stopQuiz;

    // Keyboard shortcuts
    document.onkeydown = (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        flip();
      }
      if (e.key === 'ArrowRight') next();
      if (e.key === 'ArrowLeft') prev();
    };

    // Initialize
    loadKanjiData();
  </script>
</body>
</html>