
<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flashcard Kanji — Improved Exam Mode</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#fff6fb;--card:#fff;--accent:#f6c1d9;--accent2:#ffdce6;--text:#2b2b2b;--muted:#6b7280;
}
/* Dark Theme */
body.dark{
  --bg:#0f0f0f;--card:#1b1b1b;--accent:#444;--accent2:#555;--text:#f5f5f5;--muted:#aaa;
}
/* Light Neutral Theme */
body.light{
  --bg:#f5f7fa;--card:#ffffff;--accent:#dce3f0;--accent2:#cbd9ed;--text:#1a1a1a;--muted:#757575;
}

*{box-sizing:border-box}
body{
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;
  background:var(--bg);color:var(--text);
  display:flex;justify-content:center;padding:20px;min-height:100vh;
}
.container{width:100%;max-width:920px}

.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.btn{
  background:linear-gradient(180deg,var(--accent),var(--accent2));
  border:0;padding:9px 11px;border-radius:10px;cursor:pointer;
}

.select,input[type=number]{
  padding:7px;border-radius:8px;border:1px solid var(--accent);
  background:transparent;color:var(--text);
}

.stage{display:flex;flex-direction:column;align-items:center;gap:10px}
.scene{width:460px;height:360px;perspective:1200px}

.card{
  width:100%;height:100%;border-radius:14px;background:var(--card);
  display:flex;align-items:center;justify-content:center;
  transition:transform .3s, box-shadow .3s;
  box-shadow:0 16px 40px rgba(0,0,0,0.13);
}

.flash{
  animation:flashAnim .5s ease-in-out;
}
@keyframes flashAnim {
  0%{transform:scale(1);}
  50%{transform:scale(1.06);box-shadow:0 0 20px var(--accent2);}
  100%{transform:scale(1);}
}

.kanji{font-size:60px;font-weight:800}
.furi{font-size:20px;color:var(--muted)}
.meaning{font-size:22px;margin-top:10px}

/* UI Hidden in Exam Mode */
.exam-hidden{display:inline}
.exam-mode .exam-hidden{display:none}
.exam-mode .exam-visible{display:inline}
.exam-visible{display:none}

#countdown{font-weight:bold;color:var(--accent)}

.footer{font-size:13px;color:var(--muted)}
@media(max-width:600px){.scene{width:95vw;height:65vw}.kanji{font-size:42px}}
</style>
</head>

<body class="sakura">

<div class="container">
  <div class="header">
    <div class="controls">
      <label>Mode:
        <select id="modeSelect" class="select">
          <option value="normal">Normal</option>
          <option value="exam">Shiken</option>
        </select>
      </label>
      <label class="exam-visible"> Interval <input id="intervalInput" type="number" min="1" value="10"/></label>
      <button id="startBtn" class="btn exam-visible">Mulai</button>
      <button id="stopBtn" class="btn exam-visible" style="display:none;">Stop</button>

      <button id="prevBtn" class="btn exam-hidden">←</button>
      <button id="nextBtn" class="btn exam-hidden">→</button>
      <button id="shuffleBtn" class="btn exam-hidden">Acak</button>

      <label class="exam-hidden">Level:
        <select id="levelSelect" class="select"></select>
      </label>

      <label> Tema:
        <select id="themeSelect" class="select">
          <option value="sakura">Sakura</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
        </select>
      </label>
    </div>
  </div>

  <div class="stage">
    <div class="scene">
      <div class="card" id="card">
        <div class="center">
          <div class="kanji" id="kanjiText">？</div>
          <div class="furi exam-hidden" id="furiText"></div>
          <div class="meaning exam-hidden" id="meaningText"></div>
        </div>
      </div>
    </div>

    <div class="meta exam-hidden">
      <span id="progress">0 / 0</span> &bull; <span id="levelInfo"></span>
    </div>

    <div class="footer">
      Exam: <span id="examStatus">Stopped</span> <span id="countdown"></span>
    </div>
  </div>
</div>

<script>
let data=[], filtered=[], index=0;
let exam=false, timer=null, remain=0;

const modeSelect=document.getElementById('modeSelect');
const intervalInput=document.getElementById('intervalInput');
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const levelSelect=document.getElementById('levelSelect');
const themeSelect=document.getElementById('themeSelect');

const kanjiText=document.getElementById('kanjiText');
const furiText=document.getElementById('furiText');
const meaningText=document.getElementById('meaningText');
const progressEl=document.getElementById('progress');
const levelInfo=document.getElementById('levelInfo');
const examStatus=document.getElementById('examStatus');
const countdown=document.getElementById('countdown');
const card=document.getElementById('card');

async function loadData(){
  const res = await fetch('kanji.json');
  data = await res.json();
  const maxLevel = Math.max(...data.map(x=>x.level));
  for(let l=1;l<=maxLevel;l++){
    const o=document.createElement('option');
    o.value=l; o.textContent="Level "+l;
    levelSelect.appendChild(o);
  }
  applyFilter();
}
loadData();

function applyFilter(){
  if(exam) return;
  const lv = levelSelect.value;
  filtered = data.filter(x=>String(x.level)===lv);
  index=0; render();
}

function render(){
  if(!filtered.length) return;
  const c = filtered[index];
  kanjiText.textContent=c.kanji;
  furiText.textContent=c.furi;
  meaningText.textContent=c.meaning;
  progressEl.textContent=`${index+1}/${filtered.length}`;
  levelInfo.textContent=`Level ${c.level}`;
}

function nextCard(){
  index=(index+1)%filtered.length;
  render();
  if(exam) animateFlash();
}
function animateFlash(){
  card.classList.add('flash');
  setTimeout(()=>card.classList.remove('flash'),400);
}

startBtn.onclick=()=>{
  exam=true;
  document.body.classList.add("exam-mode");
  remain=parseInt(intervalInput.value)||10;
  examStatus.textContent="Running";
  filtered = data.slice();
  index=0; render();
  stopBtn.style.display="inline-block";
  startBtn.style.display="none";
  timer=setInterval(()=>{
    remain--;
    countdown.textContent=" | "+remain+"s";
    if(remain<=0){ remain=parseInt(intervalInput.value)||10; nextCard(); }
  },1000);
};

stopBtn.onclick=()=>stopExam();
function stopExam(){
  exam=false;
  document.body.classList.remove("exam-mode");
  examStatus.textContent="Stopped";
  countdown.textContent="";
  if(timer){clearInterval(timer); timer=null;}
  startBtn.style.display="inline-block";
  stopBtn.style.display="none";
  applyFilter();
}

modeSelect.onchange=()=>{
  stopExam();
  if(modeSelect.value==="exam"){ document.body.classList.add("exam-mode"); }
  else{ document.body.classList.remove("exam-mode"); }
};

themeSelect.onchange=()=>{
  document.body.classList.remove("dark","light","sakura");
  document.body.classList.add(themeSelect.value);
};

document.getElementById('prevBtn').onclick=()=>{ if(!exam){ index=(index-1+filtered.length)%filtered.length; render(); } };
document.getElementById('nextBtn').onclick=()=>{ if(!exam) nextCard(); };
document.getElementById('shuffleBtn').onclick=()=>{
  if(!exam){
    filtered.sort(()=>Math.random()-0.5);
    index=0; render();
  }
};

levelSelect.onchange=applyFilter;
</script>

</body>
</html>
