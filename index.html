<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Belajar Bahasa Jepang - 441 Kanji</title>
  <style>
    :root {
      --w: 480px;
      --h: 380px;
      --bg-primary: linear-gradient(135deg, #fef5f8, #ffe4f0);
      --card-front: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(252,240,245,0.98));
      --card-back: linear-gradient(180deg, #ec4899, #db2777);
      --text-primary: #0f172a;
      --text-secondary: rgba(15,23,42,0.7);
      --shadow: 0 24px 60px rgba(236,72,153,0.12);
      --btn-bg: #fff;
      --btn-shadow: 0 6px 18px rgba(236,72,153,0.08);
    }
    
    [data-theme="dark"] {
      --bg-primary: linear-gradient(135deg, #1e1b4b, #312e81);
      --card-front: linear-gradient(180deg, rgba(30,27,75,0.95), rgba(49,46,129,0.98));
      --card-back: linear-gradient(180deg, #6366f1, #4f46e5);
      --text-primary: #e0e7ff;
      --text-secondary: rgba(224,231,255,0.7);
      --shadow: 0 24px 60px rgba(99,102,241,0.3);
      --btn-bg: rgba(99,102,241,0.2);
      --btn-shadow: 0 6px 18px rgba(99,102,241,0.3);
    }
    
    [data-theme="light"] {
      --bg-primary: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      --card-front: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(240,249,255,0.98));
      --card-back: linear-gradient(180deg, #0ea5e9, #0284c7);
      --text-primary: #0f172a;
      --text-secondary: rgba(15,23,42,0.7);
      --shadow: 0 24px 60px rgba(14,165,233,0.12);
      --btn-bg: #fff;
      --btn-shadow: 0 6px 18px rgba(14,165,233,0.08);
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Inter, system-ui, -apple-system, Roboto, Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background: var(--bg-primary);
      transition: background 0.3s;
    }

    .page {
      display: none;
      width: 100%;
      max-width: 1200px;
      animation: fadeIn 0.5s;
    }

    .page.active {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Welcome Screen */
    .welcome-container {
      text-align: center;
      padding: 40px 20px;
    }

    .welcome-title {
      font-size: clamp(32px, 6vw, 56px);
      font-weight: 800;
      color: var(--text-primary);
      margin: 0 0 20px 0;
      line-height: 1.2;
    }

    .welcome-subtitle {
      font-size: clamp(16px, 3vw, 22px);
      color: var(--text-secondary);
      margin: 0 0 40px 0;
    }

    .welcome-emoji {
      font-size: clamp(80px, 15vw, 120px);
      margin: 30px 0;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .btn-primary {
      padding: 18px 48px;
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, #ec4899, #db2777);
      color: white;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 0 12px 32px rgba(236,72,153,0.3);
      transition: all 0.3s;
    }

    .btn-primary:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 40px rgba(236,72,153,0.4);
    }

    /* Menu Grid */
    .menu-container {
      width: 100%;
      padding: 20px;
    }

    .menu-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .menu-title {
      font-size: clamp(28px, 5vw, 40px);
      font-weight: 800;
      color: var(--text-primary);
      margin: 0 0 10px 0;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      max-width: 900px;
      margin: 0 auto;
    }

    .menu-card {
      background: var(--btn-bg);
      border-radius: 20px;
      padding: 32px;
      box-shadow: var(--btn-shadow);
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .menu-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 16px 48px rgba(0,0,0,0.15);
    }

    .menu-card.disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .menu-card.disabled:hover {
      transform: none;
    }

    .menu-icon {
      font-size: 56px;
      margin-bottom: 16px;
    }

    .menu-card-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 8px 0;
    }

    .menu-card-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0;
    }

    .coming-soon-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
    }

    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      background: var(--btn-bg);
      border: none;
      border-radius: 12px;
      box-shadow: var(--btn-shadow);
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      z-index: 1000;
      transition: all 0.3s;
    }

    .back-btn:hover {
      transform: translateX(-4px);
    }

    /* Kanji List Page */
    .list-container {
      width: 100%;
      padding: 20px;
      margin-top: 60px;
    }

    .list-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .list-title {
      font-size: clamp(24px, 4vw, 32px);
      font-weight: 800;
      color: var(--text-primary);
      margin: 0 0 20px 0;
    }

    .level-tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 30px;
    }

    .level-tab {
      padding: 10px 20px;
      background: var(--btn-bg);
      border: 2px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      transition: all 0.3s;
    }

    .level-tab:hover {
      border-color: #ec4899;
    }

    .level-tab.active {
      background: linear-gradient(135deg, #ec4899, #db2777);
      color: white;
      border-color: transparent;
    }

    .kanji-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .kanji-item {
      background: var(--btn-bg);
      border-radius: 16px;
      padding: 20px;
      box-shadow: var(--btn-shadow);
      transition: all 0.3s;
      text-align: center;
    }

    .kanji-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0,0,0,0.12);
    }

    .kanji-char {
      font-size: 48px;
      font-weight: 800;
      color: var(--text-primary);
      margin: 0 0 8px 0;
    }

    .kanji-furi {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0 0 4px 0;
    }

    .kanji-meaning {
      font-size: 16px;
      color: var(--text-primary);
      font-weight: 600;
      margin: 0;
    }

    /* Flashcard Page (existing styles) */
    header {
      width: 100%;
      max-width: 1000px;
      margin-bottom: 20px;
      text-align: center;
      margin-top: 60px;
    }
    
    h1 {
      margin: 0 0 8px 0;
      font-size: 26px;
      color: var(--text-primary);
      font-weight: 700;
    }
    
    .subtitle {
      margin: 0;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: var(--text-primary);
    }

    .error {
      background: #fee;
      color: #c00;
      padding: 20px;
      border-radius: 12px;
      margin: 20px;
      text-align: center;
    }

    .controls-panel {
      width: 100%;
      max-width: 1000px;
      margin-bottom: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    .control-group {
      display: flex;
      gap: 8px;
      align-items: center;
      background: var(--btn-bg);
      padding: 8px 14px;
      border-radius: 12px;
      box-shadow: var(--btn-shadow);
    }

    .control-group label {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 500;
      margin-right: 4px;
    }

    select, button {
      padding: 8px 14px;
      border-radius: 10px;
      border: none;
      background: var(--btn-bg);
      color: var(--text-primary);
      box-shadow: var(--btn-shadow);
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover, select:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    button:active {
      transform: translateY(0);
    }

    .mode-switch {
      display: flex;
      gap: 4px;
      background: var(--btn-bg);
      padding: 4px;
      border-radius: 12px;
      box-shadow: var(--btn-shadow);
    }

    .mode-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background: transparent;
      box-shadow: none;
      transition: all 0.3s;
    }

    .mode-btn.active {
      background: linear-gradient(135deg, #ec4899, #db2777);
      color: white;
      box-shadow: 0 4px 12px rgba(236,72,153,0.3);
    }

    [data-theme="dark"] .mode-btn.active {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
    }

    [data-theme="light"] .mode-btn.active {
      background: linear-gradient(135deg, #0ea5e9, #0284c7);
    }

    .stage {
      width: 100%;
      max-width: var(--w);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }

    .scene {
      width: var(--w);
      height: var(--h);
      perspective: 1400px;
    }

    .card {
      width: 100%;
      height: 100%;
      border-radius: 20px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
      cursor: pointer;
    }

    .card.is-flipped {
      transform: rotateY(180deg);
    }

    .face {
      position: absolute;
      inset: 0;
      border-radius: 20px;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      backface-visibility: hidden;
      background: var(--card-front);
      box-shadow: var(--shadow);
      color: var(--text-primary);
    }

    .face.back {
      transform: rotateY(180deg);
      background: var(--card-back);
      color: white;
    }

    .kanji {
      font-weight: 800;
      line-height: 1;
      margin-bottom: 8px;
      text-align: center;
    }

    .furigana {
      color: rgba(255,255,255,0.9);
      margin-bottom: 8px;
      text-align: center;
    }

    .meaning {
      color: rgba(255,255,255,0.95);
      margin-top: 8px;
      text-align: center;
      font-weight: 500;
    }

    .level-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255,255,255,0.3);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    [data-font="default"] .kanji { font-size: clamp(48px, 8vw, 72px); }
    [data-font="default"] .furigana { font-size: clamp(16px, 2.5vw, 22px); }
    [data-font="default"] .meaning { font-size: clamp(18px, 3vw, 24px); }

    [data-font="medium"] .kanji { font-size: clamp(60px, 10vw, 90px); }
    [data-font="medium"] .furigana { font-size: clamp(20px, 3vw, 28px); }
    [data-font="medium"] .meaning { font-size: clamp(22px, 3.5vw, 30px); }

    [data-font="big"] .kanji { font-size: clamp(72px, 12vw, 108px); }
    [data-font="big"] .furigana { font-size: clamp(24px, 3.5vw, 34px); }
    [data-font="big"] .meaning { font-size: clamp(26px, 4vw, 36px); }

    .controls-row {
      display: flex;
      gap: 10px;
      width: 100%;
      justify-content: center;
      flex-wrap: wrap;
    }

    .pager {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .meta {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 600;
      min-width: 80px;
      text-align: center;
    }

    .quiz-panel {
      display: none;
      width: 100%;
      max-width: 600px;
      background: var(--btn-bg);
      padding: 20px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      margin-top: 20px;
    }

    .quiz-panel.active {
      display: block;
    }

    .quiz-options {
      display: grid;
      gap: 10px;
      margin-top: 15px;
    }

    .quiz-option {
      padding: 14px 18px;
      border-radius: 10px;
      background: var(--btn-bg);
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
      font-size: 15px;
      color: var(--text-primary);
    }

    .quiz-option:hover {
      border-color: #ec4899;
      transform: translateX(4px);
    }

    .quiz-option.correct {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }

    .quiz-option.wrong {
      background: #ef4444;
      color: white;
      border-color: #ef4444;
    }

    .quiz-option:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .quiz-settings {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .quiz-settings label {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .quiz-settings input {
      padding: 6px 10px;
      border-radius: 8px;
      border: 2px solid var(--text-secondary);
      background: transparent;
      color: var(--text-primary);
      font-size: 14px;
      width: 80px;
    }

    .quiz-result {
      margin-top: 15px;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      display: none;
    }

    .quiz-result.show {
      display: block;
    }

    @media (max-width: 560px) {
      :root { --w: 92vw; --h: 70vw; }
      h1 { font-size: 22px; }
      .controls-panel { padding: 0 8px; }
      .menu-grid { grid-template-columns: 1fr; }
      .kanji-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
    }
  </style>
</head>
<body data-theme="sakura" data-font="default">

  <!-- Loading Screen -->
  <div id="loadingScreen" class="loading">
    ⏳ Memuat data kanji...
  </div>

  <!-- Welcome Page -->
  <div id="welcomePage" class="page" style="display:none;">
    <div class="welcome-container">
      <div class="welcome-emoji">🎌</div>
      <h1 class="welcome-title">Selamat Datang!</h1>
      <p class="welcome-subtitle">Website Belajar Bahasa Jepang<br>441 Kanji • 9 Level • Interaktif</p>
      <button class="btn-primary" onclick="showMenu()">🚀 Mulai Belajar</button>
    </div>
  </div>

  <!-- Menu Page -->
  <div id="menuPage" class="page">
    <div class="menu-container">
      <div class="menu-header">
        <h1 class="menu-title">📚 Pilih Menu Belajar</h1>
        <p style="color: var(--text-secondary); margin: 0;">Pilih metode belajar yang sesuai dengan kebutuhanmu</p>
      </div>

      <div class="menu-grid">
        <!-- Flashcard -->
        <div class="menu-card" onclick="showFlashcard()">
          <div class="menu-icon">🃏</div>
          <h2 class="menu-card-title">Flashcard Kanji</h2>
          <p class="menu-card-desc">Belajar dengan kartu interaktif + mode ujian</p>
        </div>

        <!-- Daftar Kanji -->
        <div class="menu-card" onclick="showKanjiList()">
          <div class="menu-icon">📋</div>
          <h2 class="menu-card-title">Daftar Kanji</h2>
          <p class="menu-card-desc">Lihat semua kanji berdasarkan level</p>
        </div>

        <!-- Modul Kotoba -->
        <div class="menu-card disabled">
          <span class="coming-soon-badge">COMING SOON</span>
          <div class="menu-icon">📖</div>
          <h2 class="menu-card-title">Modul Kotoba</h2>
          <p class="menu-card-desc">Kosakata harian bahasa Jepang</p>
        </div>

        <!-- Modul Charenji -->
        <div class="menu-card disabled">
          <span class="coming-soon-badge">COMING SOON</span>
          <div class="menu-icon">🎯</div>
          <h2 class="menu-card-title">Modul Charenji</h2>
          <p class="menu-card-desc">Tantangan & latihan intensif</p>
        </div>

        <!-- Modul Minna no Nihongo -->
        <div class="menu-card disabled">
          <span class="coming-soon-badge">COMING SOON</span>
          <div class="menu-icon">📚</div>
          <h2 class="menu-card-title">Minna no Nihongo</h2>
          <p class="menu-card-desc">Materi lengkap per bab</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Kanji List Page -->
  <div id="kanjiListPage" class="page">
    <button class="back-btn" onclick="showMenu()">← Kembali</button>
    <div class="list-container">
      <div class="list-header">
        <h1 class="list-title">📋 Daftar Kanji per Level</h1>
        <p style="color: var(--text-secondary); margin: 0;">Total <strong id="totalKanjiCount">441</strong> Kanji</p>
      </div>

      <div class="level-tabs" id="levelTabs">
        <button class="level-tab active" onclick="filterKanjiList('all')">Semua Level</button>
        <button class="level-tab" onclick="filterKanjiList(1)">Level 1</button>
        <button class="level-tab" onclick="filterKanjiList(2)">Level 2</button>
        <button class="level-tab" onclick="filterKanjiList(3)">Level 3</button>
        <button class="level-tab" onclick="filterKanjiList(4)">Level 4</button>
        <button class="level-tab" onclick="filterKanjiList(5)">Level 5</button>
        <button class="level-tab" onclick="filterKanjiList(6)">Level 6</button>
        <button class="level-tab" onclick="filterKanjiList(7)">Level 7</button>
        <button class="level-tab" onclick="filterKanjiList(8)">Level 8</button>
        <button class="level-tab" onclick="filterKanjiList(9)">Level 9</button>
      </div>

      <div class="kanji-grid" id="kanjiGrid"></div>
    </div>
  </div>

  <!-- Flashcard Page -->
  <div id="flashcardPage" class="page">
    <button class="back-btn" onclick="showMenu()">← Kembali</button>
    
    <header>
      <h1>🃏 Flashcard Kanji - 441 Kata</h1>
      <p class="subtitle">Belajar Kanji dengan mudah dan menyenangkan!</p>
    </header>

    <div class="controls-panel">
      <div class="control-group">
        <label>Tema:</label>
        <select id="themeSelect">
          <option value="sakura">🌸 Sakura</option>
          <option value="dark">🌙 Dark</option>
          <option value="light">☀️ Light</option>
        </select>
      </div>

      <div class="control-group">
        <label>Ukuran Font:</label>
        <select id="fontSelect">
          <option value="default">Default</option>
          <option value="medium">Medium</option>
          <option value="big">Big</option>
        </select>
      </div>

      <div class="control-group">
        <label>Filter Level:</label>
        <select id="levelFilter">
          <option value="all">Semua Level</option>
          <option value="1">Level 1</option>
          <option value="2">Level 2</option>
          <option value="3">Level 3</option>
          <option value="4">Level 4</option>
          <option value="5">Level 5</option>
          <option value="6">Level 6</option>
          <option value="7">Level 7</option>
          <option value="8">Level 8</option>
          <option value="9">Level 9</option>
        </select>
      </div>

      <div class="mode-switch">
        <button class="mode-btn active" data-mode="normal">📖 Normal</button>
        <button class="mode-btn" data-mode="quiz">✍️ Ujian</button>
      </div>
    </div>

    <div class="stage" id="normalMode">
      <div class="scene">
        <div class="card" id="card">
          <div class="face front">
            <div class="level-badge" id="levelBadgeFront">Lv 1</div>
            <div class="kanji" id="frontKanji">—</div>
          </div>
          <div class="face back">
            <div class="level-badge" id="levelBadgeBack">Lv 1</div>
            <div class="kanji" id="backKanji">—</div>
            <div class="furigana" id="backFuri">—</div>
            <div class="meaning" id="backMeaning">—</div>
          </div>
        </div>
      </div>

      <div class="controls-row">
        <div class="pager">
          <button id="prevBtn">← Prev</button>
          <div class="meta" id="progress">0 / 0</div>
          <button id="nextBtn">Next →</button>
        </div>
        <button id="flipBtn">🔄 Balik</button>
        <button id="shuffleBtn">🎲 Acak</button>
      </div>
    </div>

    <div class="quiz-panel" id="quizMode">
      <div class="quiz-settings">
        <label>Interval (detik):</label>
        <input type="number" id="quizInterval" value="10" min="5" max="60">
        <button id="startQuizBtn">▶️ Mulai Ujian</button>
        <button id="stopQuizBtn" style="display:none;">⏸️ Stop</button>
      </div>
      
      <div style="margin-top:20px;">
        <h2 style="margin:0 0 10px 0; font-size:20px; color: var(--text-primary);">Arti dari:</h2>
        <div style="font-size:48px; font-weight:800; text-align:center; margin:20px 0; color: var(--text-primary);" id="quizKanji">—</div>
        <div class="quiz-options" id="quizOptions"></div>
        <div class="quiz-result" id="quizResult"></div>
      </div>

      <div style="margin-top:20px; text-align:center; color: var(--text-primary);">
        <strong>Skor: <span id="quizScore">0</span> / <span id="quizTotal">0</span></strong>
        <span style="margin-left:20px;">Waktu: <span id="quizTimer">0</span>s</span>
      </div>
    </div>
  </div>

  <script>
    // Variables
    let allKanjiData = [];
    let filteredCards = [];
    let currentIndex = 0;
    let quizTimer = null;
    let quizTimeElapsed = 0;
    let quizScore = 0;
    let quizTotal = 0;
    let currentQuizQuestion = null;
    let currentListLevel = 'all';

    // Elements
    const loadingScreen = document.getElementById('loadingScreen');
    const welcomePage = document.getElementById('welcomePage');
    const menuPage = document.getElementById('menuPage');
    const kanjiListPage = document.getElementById('kanjiListPage');
    const flashcardPage = document.getElementById('flashcardPage');
    const themeSelect = document.getElementById('themeSelect');
    const fontSelect = document.getElementById('fontSelect');
    const levelFilter = document.getElementById('levelFilter');
    const card = document.getElementById('card');
    const frontKanji = document.getElementById('frontKanji');
    const backKanji = document.getElementById('backKanji');
    const backFuri = document.getElementById('backFuri');
    const backMeaning = document.getElementById('backMeaning');
    const levelBadgeFront = document.getElementById('levelBadgeFront');
    const levelBadgeBack = document.getElementById('levelBadgeBack');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const flipBtn = document.getElementById('flipBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const progress = document.getElementById('progress');
    const normalMode = document.getElementById('normalMode');
    const quizMode = document.getElementById('quizMode');
    const startQuizBtn = document.getElementById('startQuizBtn');
    const stopQuizBtn = document.getElementById('stopQuizBtn');
    const quizInterval = document.getElementById('quizInterval');
    const quizKanji = document.getElementById('quizKanji');
    const quizOptions = document.getElementById('quizOptions');
    const quizResult = document.getElementById('quizResult');
    const quizScoreEl = document.getElementById('quizScore');
    const quizTotalEl = document.getElementById('quizTotal');
    const quizTimerEl = document.getElementById('quizTimer');
    const kanjiGrid = document.getElementById('kanjiGrid');
    const totalKanjiCount = document.getElementById('totalKanjiCount');

    // Navigation Functions
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    function showMenu() {
      showPage('menuPage');
      stopQuiz();
    }

    function showFlashcard() {
      showPage('flashcardPage');
      render();
    }

    function showKanjiList() {
      showPage('kanjiListPage');
      renderKanjiList('all');
    }

    // Load Kanji Data from JSON
    async function loadKanjiData() {
      try {
        const response = await fetch('kanji.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        allKanjiData = await response.json();
        
        if (!allKanjiData || allKanjiData.length === 0) {
          throw new Error('Data kanji kosong atau format salah');
        }

        filteredCards = [...allKanjiData];
        loadingScreen.style.display = 'none';
        welcomePage.style.display = 'flex';
        welcomePage.classList.add('active');
        totalKanjiCount.textContent = allKanjiData.length;
        console.log(`✅ Berhasil memuat ${allKanjiData.length} kanji`);
      } catch (error) {
        console.error('Error loading kanji data:', error);
        loadingScreen.innerHTML = `
          <div class="error">
            <h3>❌ Gagal Memuat Data Kanji</h3>
            <p>Error: ${error.message}</p>
            <p style="margin-top:15px; font-size:14px;">
              <strong>Pastikan:</strong><br>
              1. File <code>kanji.json</code> ada di folder yang sama dengan index.html<br>
              2. Jalankan dengan local web server (bukan buka file langsung)<br>
              3. Gunakan: <code>python -m http.server 8000</code> atau <code>php -S localhost:8000</code>
            </p>
          </div>
        `;
      }
    }

    // Kanji List Functions
    function renderKanjiList(level) {
      currentListLevel = level;
      const filtered = level === 'all' ? allKanjiData : allKanjiData.filter(k => k.level === level);
      
      kanjiGrid.innerHTML = '';
      
      if (filtered.length === 0) {
        kanjiGrid.innerHTML = '<p style="text-align:center; color:var(--text-secondary); grid-column: 1/-1;">Tidak ada data</p>';
        return;
      }

      filtered.forEach(kanji => {
        const item = document.createElement('div');
        item.className = 'kanji-item';
        item.innerHTML = `
          <div class="kanji-char">${kanji.kanji}</div>
          <div class="kanji-furi">${kanji.furi}</div>
          <div class="kanji-meaning">${kanji.meaning}</div>
          <div style="margin-top:8px; font-size:11px; color:var(--text-secondary); font-weight:600;">Level ${kanji.level}</div>
        `;
        kanjiGrid.appendChild(item);
      });

      // Update active tab
      document.querySelectorAll('.level-tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
    }

    function filterKanjiList(level) {
      renderKanjiList(level);
      
      // Update tab active state
      document.querySelectorAll('.level-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
    }

    // Flashcard Functions
    function render() {
      if (!filteredCards.length) {
        frontKanji.textContent = '—';
        backKanji.textContent = '—';
        backFuri.textContent = '—';
        backMeaning.textContent = '—';
        levelBadgeFront.textContent = '—';
        levelBadgeBack.textContent = '—';
        progress.textContent = '0 / 0';
        return;
      }

      const c = filteredCards[currentIndex];
      frontKanji.textContent = c.kanji;
      backKanji.textContent = c.kanji;
      backFuri.textContent = c.furi;
      backMeaning.textContent = c.meaning;
      levelBadgeFront.textContent = `Lv ${c.level}`;
      levelBadgeBack.textContent = `Lv ${c.level}`;
      progress.textContent = `${currentIndex + 1} / ${filteredCards.length}`;
      card.classList.remove('is-flipped');
    }

    function next() {
      if (!filteredCards.length) return;
      currentIndex = (currentIndex + 1) % filteredCards.length;
      render();
    }

    function prev() {
      if (!filteredCards.length) return;
      currentIndex = (currentIndex - 1 + filteredCards.length) % filteredCards.length;
      render();
    }

    function flip() {
      if (!filteredCards.length) return;
      card.classList.toggle('is-flipped');
    }

    function shuffle() {
      if (!filteredCards.length) return;
      filteredCards.sort(() => Math.random() - 0.5);
      currentIndex = 0;
      render();
    }

    // Theme & Font
    themeSelect.addEventListener('change', (e) => {
      document.body.setAttribute('data-theme', e.target.value);
    });

    fontSelect.addEventListener('change', (e) => {
      document.body.setAttribute('data-font', e.target.value);
    });

    // Level Filter
    levelFilter.addEventListener('change', (e) => {
      const level = e.target.value;
      if (level === 'all') {
        filteredCards = [...allKanjiData];
      } else {
        filteredCards = allKanjiData.filter(k => k.level === parseInt(level));
      }
      currentIndex = 0;
      render();
    });

    // Mode Switch
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const mode = btn.dataset.mode;
        if (mode === 'normal') {
          normalMode.style.display = 'flex';
          quizMode.classList.remove('active');
          stopQuiz();
        } else {
          normalMode.style.display = 'none';
          quizMode.classList.add('active');
        }
      });
    });

    // Quiz Mode
    function startQuiz() {
      if (!filteredCards.length) return;
      
      quizScore = 0;
      quizTotal = 0;
      quizTimeElapsed = 0;
      quizScoreEl.textContent = '0';
      quizTotalEl.textContent = '0';
      quizTimerEl.textContent = '0';
      
      startQuizBtn.style.display = 'none';
      stopQuizBtn.style.display = 'inline-block';
      
      generateQuizQuestion();
      
      quizTimer = setInterval(() => {
        quizTimeElapsed++;
        quizTimerEl.textContent = quizTimeElapsed;
      }, 1000);
    }

    function stopQuiz() {
      if (quizTimer) {
        clearInterval(quizTimer);
        quizTimer = null;
      }
      startQuizBtn.style.display = 'inline-block';
      stopQuizBtn.style.display = 'none';
      quizResult.classList.remove('show');
    }

    function generateQuizQuestion() {
      if (!filteredCards.length) return;
      
      quizResult.classList.remove('show');
      
      const randomIndex = Math.floor(Math.random() * filteredCards.length);
      currentQuizQuestion = filteredCards[randomIndex];
      
      quizKanji.textContent = currentQuizQuestion.kanji;
      
      const correctAnswer = currentQuizQuestion.meaning;
      const wrongAnswers = [];
      
      while (wrongAnswers.length < 3) {
        const randomKanji = filteredCards[Math.floor(Math.random() * filteredCards.length)];
        if (randomKanji.meaning !== correctAnswer && !wrongAnswers.includes(randomKanji.meaning)) {
          wrongAnswers.push(randomKanji.meaning);
        }
      }
      
      const allOptions = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);
      
      quizOptions.innerHTML = '';
      allOptions.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'quiz-option';
        btn.textContent = option;
        btn.onclick = () => checkAnswer(option, correctAnswer);
        quizOptions.appendChild(btn);
      });
    }

    function checkAnswer(selected, correct) {
      quizTotal++;
      quizTotalEl.textContent = quizTotal;
      
      const buttons = quizOptions.querySelectorAll('.quiz-option');
      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === correct) {
          btn.classList.add('correct');
        }
        if (btn.textContent === selected && selected !== correct) {
          btn.classList.add('wrong');
        }
      });
      
      if (selected === correct) {
        quizScore++;
        quizScoreEl.textContent = quizScore;
        quizResult.textContent = '✅ Benar!';
        quizResult.style.background = '#d1fae5';
        quizResult.style.color = '#065f46';
      } else {
        quizResult.textContent = `❌ Salah! Jawaban: ${correct}`;
        quizResult.style.background = '#fee2e2';
        quizResult.style.color = '#991b1b';
      }
      
      quizResult.classList.add('show');
      
      const interval = parseInt(quizInterval.value) * 1000;
      setTimeout(() => {
        if (quizTimer) {
          generateQuizQuestion();
        }
      }, interval);
    }

    // Event Listeners
    nextBtn.onclick = next;
    prevBtn.onclick = prev;
    flipBtn.onclick = flip;
    shuffleBtn.onclick = shuffle;
    card.onclick = flip;
    startQuizBtn.onclick = startQuiz;
    stopQuizBtn.onclick = stopQuiz;

    // Keyboard shortcuts
    document.onkeydown = (e) => {
      if (flashcardPage.classList.contains('active')) {
        if (e.code === 'Space') {
          e.preventDefault();
          flip();
        }
        if (e.key === 'ArrowRight') next();
        if (e.key === 'ArrowLeft') prev();
      }
    };

    // Initialize
    loadKanjiData();
  </script>
</body>
</html>